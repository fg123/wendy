import bus

let TestHandler => (a) {
	Bus("Output").post("A: " + a);
};

let TestHandlerB => (a) {
	Bus("Output").post("B: " + a);
};

let TestHandlerD => (a) {
	Bus("Output").post("C: " + a);
};

let TestHandlerC => (a) {
	Bus("Output").post("D: " + a);
};

Bus("Output").register(#:(x) { x; });

Bus("Input").register(TestHandler);
Bus("Input").register(TestHandlerB);
Bus("Input2").register(TestHandlerC);
Bus("Input2").register(TestHandlerD);

Bus("Aggregate").aggregate("Input", "Input2");
Bus("Aggregate").register(#:(x) { "Aggregate: " + x; });

Bus("Split").split("Input", "Input2");

for i in 1->10 {
	Bus("Split").post(i);
//	Bus("Input").post(i);
//	Bus("Input2").post(i);
}

